<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<link rel="stylesheet" href="../resource/css/common.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
<script type="text/javascript" src="../resource/js/common.util.js"></script>

<script>

var getInterestStockByDate = function( cbFunction ){

	if( !window.socketData.renderTradeValueInfo_object ) return;

	var params = window.UTIL.Url.paramToObject();
	var xhr = new XMLHttpRequest();

	xhr.open("GET" , `http://112.144.208.118:8888/getInterestStockByDate?date=${params.date}`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			var d = JSON.parse( xhr.responseText )
			cbFunction( d.data )
		}
	}

	xhr.send();

}

var renderInterestStockByDate = function( d ){
	
	console.log( "[ S ] - renderInterestStockByDate" )
	
	var _html = "";
//	var i = 0,iLen = d.length,io;
	var i = 0,iLen = 100,io;
	for(;i<iLen;++i){
		io = d[ i ]
		var curData = window.socketData.renderTradeValueInfo_object[ io.cd ]
		var color00 = "red"
		var symbol = "▲"
		if( curData.rt < 0 ) 
		{
			color00 = "blue"	
			var symbol = "▼"
		}
		if( curData.rt == 0 )
		{
			color00 = "gery"	
			var symbol = "-"
		}

		var color = generateColor('#FF0000','#cccccc',io.gap)				
		 _html += `
		 <div class="card" style="padding: 10px;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;" id="mass_b_00_${io.cd}" data-cd-value="${io.cd}" data-nm-value="${io.nm}">
			
			<div class="">

			<!--div class="right floated meta" style="position: relative;color: #${color};padding: 5px;min-width: 30px;text-align: center;font-size:15px;font-weight:bold;">${curData.price}( ${ ( curData.rt ).toFixed(2)}</div-->
			<span style="font-size:15px;"> ${io.nm}</span><span style="font-size:11px;">  ${io.cd}</span> 	
				<div style="font-size:16px;color:${color00}">${window.UTIL.Number.numberWithCommas(curData.price)} 
					<span style="font-size:12px;color:${color00}">${symbol} ${window.UTIL.Number.numberWithCommas( curData.prevChange )}( ${ ( curData.rt ).toFixed(2)}% )</span><br>
					<span style="font-size:12px;color:${color00}">${window.UTIL.Number.longNumberAddString( curData.tradeValue ) }</span>
				</div>
			<div style="font-size:11px;">
			개인   : ${window.UTIL.Number.longNumberAddString( io.pp.tr1 )} | 외국인 : ${window.UTIL.Number.longNumberAddString( io.pp.tr2 )} | 기관계 : ${window.UTIL.Number.longNumberAddString( io.pp.tr3 )}
			</div>
			</div>

			<div class="image" style="background-color: #fff/*${color}*/;">
				<div style="position: relative;color: #fff;padding: 5px;min-width: 30px;text-align: center;font-size:15px;font-weight:bold;"></div>
				<img src="https://t1.daumcdn.net/finance/chart/kr/stock/d/A${io.cd}.png" style="" load="lazy">
				
			</div>
			<!--div class="description">
			</div-->

			</div>
			
		 </div>
		`
	}
	var _tDom = window.document.getElementById( "interest" );
	_tDom.innerHTML = _html
	
	_tDom.addEventListener( "click",function(e){
		debugger;
		var cd = e.currentTarget.getAttribute( "data-cd-value" );
		var a = window.document.createElement( "a" );
		a.target = "_blank";
		a.href = "/html/candle.html?cd=" + cd
		a.click();
		a = null;

	})
	
}


window.addEventListener('DOMContentLoaded', (event) => {


	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;





	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;






	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	window.Websocket.init();
	window.COMPONENT.gnb();
	window.COMPONENT.stockSearch_global();
	var wsReqData = function( d ){
		if( !window.ws || window.ws.readyState != 1 )
		{
			console.log( "not yet window.ws" )
			return setTimeout(function(){
				wsReqData( d )
			},2000)
		}
		var _d = JSON.stringify( d )
		console.log( _d )
		window.ws.send( _d );			
	}
	wsReqData( { type : "execFunc", funcNm : "renderTradeValueInfo_object" } )
	getInterestStockByDate( renderInterestStockByDate );
})
</script>

<body style="padding:50px;">
	<div class="ui stackable grid">
		<div id="gnb" class="eight wide column" style="padding: 20px;"></div>
		<div id="search_wrap" class="eight wide column" style="padding: 20px;"></div>

		<div class="sixteen wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="market_index_title" style="">
				국내외증시
				</div>
				<div class="six wide column">
					<div class="ui two cards" id="market_index"></div>
				</div>
				<div class="ten wide column">
					<div class="ui five cards" id="market_index_1"></div>
				</div>
			</div>
		</div>
		<div class="sixteen wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="" style="">
					<div class="ui six cards" id="interest"></div>
				</div>
			</div>
		</div>
	</div>
</body>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<link rel="stylesheet" href="../resource/css/common.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
<script type="text/javascript" src="../resource/js/common.util.js"></script>

<script>








window.wsFns = {};

window.wsFns.renderTradeValueRank = function(){
	if( window.socketData.renderTradeValueInfo.length == 0 ) return;
	
	var domId = "tradeValueTree";
	
	var dom = document.getElementById( domId );
	if( !window.treemapChart_03 )
	{
		window.treemapChart_03 = echarts.init(dom);
		window.treemapChart_03.isEvent = 0;
	}
	
	//window.treemapChart_03.showLoading()

	var _chartData = [];
	
	//d.sort(function(a,b){ return a.rt - b.rt }).reverse()
	//var i =0,iLen = window.socketData.updateRank.length,io;
	
	var i = 0,iLen = window.socketData.renderTradeValueInfo.length,so;
	for(;i<iLen;++i){
		so = window.socketData.renderTradeValueInfo[i]
		
		var symbol = "▲"
		if( so.rt == 0 ) 
		{
			var symbol = "-"
		}
		if( so.rt < 0 ) 
		{
			var symbol = "▼"	
		}
		
		
		var _o = {
			name : so.nm
			,cd : so.cd
			,value : [ so.tradeValue, so.rt ]
			,price : so.price
			,rt : so.rt
			,r_mark : symbol
			,tradeValue : so.tradeValue
			,amt : so.amt
			,children : []
		}
		_chartData.push( _o )
	}
	var h = dom.style.height.replace("px") * 1 - 0
	var chartData = _chartData.sort(function(a,b){ return a.rt - b.rt }).reverse();
	var app = {};

	var option;
	var nowDate = window.UTIL.Date.getTimeTo__YYYYMMDD_HHMMSS()
	var title = "실시간 거래대금순위 - " + nowDate;
	var subTitle = nowDate
	option = {

		title : { show :true, text : title,textStyle : { fontSize:12 } },
		grid : { top:10,bottom:0 },
		height : h,
		series: [
			{ type: 'treemap', leafDepth: null, roam: true, nodeClick: false,
			breadcrumb : { show : false, },
			width :"100%",
			//height :h,
			//top:0,
			data : chartData.slice(0,100),
//			data : chartData,
			label : { formatter: function (params) { 
			let arr = [ "{title|" + params.name + "}",
				"{hr|}",
				"{a|" + echarts.format.addCommas(params.data.price) + " " + params.data.r_mark + echarts.format.addCommas(params.data.rt) + "%}",			
				"{hr|}",
				"{b|" + window.UTIL.Number.longNumberAddString( params.data.tradeValue) + "}",
				//"{a|" + echarts.format.addCommas(params.data.amt) + "}",

			];
			return arr.join('\n');
			}
			, rich : {
				title : { fontSize: 14 },
				a : { fontSize: 9 },
				b : { fontSize: 12 },
				hr : { 
					width : "100%",
					borderColor : "rgba(255,255,255,0.0)",
					borderWidth : 0.5,
					height : 0,
					lineHeight : 10,
				}
			}
			},
			visualMin : -30,
			visualMax : 30,
			visualDimension : 1,
			levels: [{ color: ['blue','#ccc','red'],colorMappingBy: 'value',itemStyle: {gapWidth: 1}}]
		}
		]
	};

	if( option && typeof option === 'object' ){
	window.treemapChart_03.setOption(option);
	window.treemapChart_03.resize();

	//setTimeout(function(){ window.treemapChart_03.hideLoading(); },1000)
	
	}

	if( !window.treemapChart_03.isEvent )
	{
		window.treemapChart_03.on('click',function(d){
			window.barChart.curCd = d.data.cd;
			getTradeValueByCd()
		})
		window.treemapChart_03.isEvent = 1;
	}
}


window.wsFns.renderTradeValueInfo = function(){
	window.wsFns.renderTradeValueRank();
}

window.wsFns.renderTradeValueInfo_gap = function(){
	window.wsFns.renderTradeValueList();
}

window.wsFns.renderTradeValueList = function(){
	console.log( "[ S ] - window.wsFns.renderTradeValueList" )
	
	if( window.socketData.renderTradeValueInfo_gap.length == 0 ) return;
	
	var domId = "tradeValueTreeGap";
	
	var dom = document.getElementById( domId );
	if( !window.treemapChart_04 )
	{
		window.treemapChart_04 = echarts.init(dom);
		window.treemapChart_04.isEvent = 0;
	}
	
	//window.treemapChart_04.showLoading()

	var _chartData = [];
	var colors = [];
	//d.sort(function(a,b){ return a.rt - b.rt }).reverse()
	//var i =0,iLen = window.socketData.updateRank.length,io;
	
	//var i = 0,iLen = window.socketData.renderTradeValueInfo_gap.length,so;
	var i = 0,iLen = 50,so;
	for(;i<iLen;++i){
		so = window.socketData.renderTradeValueInfo_gap[i]
		
		var symbol = "▲"
		var id = 0
		if( so.rt == 0 ) 
		{
			var symbol = "-"
			var id = 1
		}
		if( so.rt < 0 ) 
		{
			var symbol = "▼"	
			var id = 2
		}

		var _o = {
			name : so.nm
			,cd : so.cd
			,value : [ so.tradeValueGap, so.rtChange ]
			,price : so.price
			,rt : so.rt
			,rtChange : so.rtChange
			,curRt : so.curRt
			,prevRt : so.prevRt
			,r_mark : symbol
			,tradeValue : so.tradeValue
			,tradeValueGap : so.tradeValueGap
			,amt : so.amt
			,children : []
		}
		_chartData.push( _o )
	}
	var h = dom.style.height.replace("px") * 1
	var chartData = _chartData.sort(function(a,b){ return b.tradeValueGap - a.tradeValueGap });
	var app = {};

	var option;
	var nowDate = window.UTIL.Date.getTimeTo__YYYYMMDD_HHMMSS()
	var title = "실시간 거래대금갭 - " + nowDate;
	var subTitle = nowDate;
	option = {
		title : { show :true, text : title,textStyle : { fontSize:12 } },
		grid : { top:10,bottom : 0 },
		height : h,
		series: [
			{ type: 'treemap', leafDepth: null, roam: true, nodeClick: false,
			breadcrumb : { show : false, },
			width :"100%",
			//height :h,
			//top:0,
			data : chartData,
			label : { formatter: function (params) { 
			let arr = [ "{title|" + params.name + "}",
				//"{hr|}",
				"{a|" + echarts.format.addCommas(params.data.price) + " " + params.data.r_mark + echarts.format.addCommas(params.data.rt) + "%}",			
				"{hr|}",
				"{a|volume:" + echarts.format.addCommas(params.data.amt) + " / value:" + window.UTIL.Number.longNumberAddString(params.data.tradeValue) + "}",
				"{a|curRt:" + echarts.format.addCommas(params.data.curRt) + " / prevRt:" + echarts.format.addCommas(params.data.prevRt) + "}",
				"{hr|}",
				"{b|" + window.UTIL.Number.longNumberAddString( params.data.tradeValueGap ) + "(" + echarts.format.addCommas(params.data.rtChange.toFixed(2)) + "%)}",

			];
			return arr.join('\n');
			}
			, rich : {
				title : { fontSize: 14 },
				a : { fontSize: 9 },
				b : { fontSize: 12 },
				hr : { 
					width : "100%",
					borderColor : "rgba(255,255,255,0.0)",
					borderWidth : 0.5,
					height : 0,
					lineHeight : 10,
				}
			}
			},
			visualMin : -1,
			visualMax : 1,
			visualDimension : 1,
			levels: [{ color: ['blue','#999','red'],colorMappingBy: 'value',itemStyle: {gapWidth: 1}}]
		}
		]
	};

	if( option && typeof option === 'object' ){
	window.treemapChart_04.setOption(option);
	window.treemapChart_04.resize();

	//setTimeout(function(){ window.treemapChart_04.hideLoading(); },1000)
	
	}

	if( !window.treemapChart_04.isEvent )
	{
		window.treemapChart_04.on('click',function(d){
			window.barChart.curCd = d.data.cd
			getTradeValueByCd()
//			var a = window.document.createElement( "a" );
//			a.target = "_blank";
//			a.href = "/html/candle.html?cd=" + d.data.cd
//			a.click();
//			a = null;
		})
		window.treemapChart_04.isEvent = 1;
	}
	console.log( "[ E ] - window.wsFns.renderTradeValueList" )
}

window.wsFns.getMarketIndex = function( cbFunction ){
		
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET" , `http://112.144.208.118:8888/getMarketIndex`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			
			var d = JSON.parse( xhr.responseText )
			window.socketData.MarketIndex = d;
			window.wsFns.renderMarketIndex()
			cbFunction();
			
		}
	}
	
	xhr.send();

}

window.wsFns.renderMarketIndex = function(){
	//window._el.id_market_index.innerHTML = "";
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;
	var i = 0,iLen = window.socketData.MarketIndex.datas.length,io;
	for(;i<iLen;++i){
		io = window.socketData.MarketIndex.datas[ i ];
		//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)

		if( io.marketStatus == "CLOSE") display = "block"
		else display = "none"

//https://ssl.pstatic.net/imgfinance/chart/mobile/world/mini/.DJI_home_open.png?1649664420000
//https://ssl.pstatic.net/imgfinance/chart/mobile/mini/KOSDAQ_home_open.png?1649754060000
	
		var _html00 = `<div class="card" style="padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;min-height:10px;" id="market_index_${io.symbolCode}" data-cd-value="${io.symbolCode}" data-nm-value="${io.stockName}">`
		var _html01 = `
				<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
				<div class="">
					<span class="right floated" style="padding: 5px;background-color: #fff;min-height:35px;">
						<img src="https://ssl.pstatic.net/imgfinance/chart/mobile/mini/${io.symbolCode}_home_open.png?${Date.now()}" load="lazy" style="height:35px">

					</span>
					<span style="font-size:15px;"> ${io.symbolCode}</span> - <span style="font-size:11px;">  ${io.marketStatus}</span><br>
					<span style="font-size:16px;color:${status[ io.compareToPreviousPrice.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)} <br>
						<span style="font-size:12px;color:${status[ io.compareToPreviousPrice.name ].color}">${status[ io.compareToPreviousPrice.name ].symbol} ${io.compareToPreviousClosePrice}( ${ io.fluctuationsRatio}% )</span>
					</span>

				</div>

				<!--div class="description"></div-->
			`
			var _html02 =`</div>`

			//window._el.id_market_index.appendChild( new_el )


			var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
			var target_el = window.document.getElementById( "market_index_" + io.symbolCode )
			if( target_el )
			{
				//window._el.id_market_index.lastElementChild.parentNode.removeChild( target_el )
				//window._el.id_market_index.insertBefore( new_el,window._el.id_market_index.firstChild )
				target_el.innerHTML = _html01
				
			}
			else
			{
				window._el.id_market_index.appendChild( new_el )	
			}
	}

}



window.wsFns.getMarketIndexGlobal = function(){
		
		var xhr = new XMLHttpRequest();
		
		xhr.open("GET" , `http://112.144.208.118:8888/getMarketIndexGlobal`, true);
		xhr.onreadystatechange = function(){
			
			if( xhr.readyState == 4 && xhr.status == 200)
			{
				debugger;
				
				var d = JSON.parse( xhr.responseText )
				window.socketData.MarketIndexGlobal = d;
				//window._el.id_market_index.innerHTML = "";
				window.wsFns.renderMarketIndexGlobal();
				
			}
		}
		
		xhr.send();
	
	}
window.wsFns.renderMarketIndexGlobal = function(){
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;
	var s,so;
	for( s in window.socketData.MarketIndexGlobal ){
		so = window.socketData.MarketIndexGlobal[ s ];
		//if( s != "USA") continue
		var i = 0,iLen = so.length,io;
		for(;i<iLen;++i){
			io = so[ i ];
			//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)		
			var name = ""
			//if( io.stockEndType != "futures") continue;

			if( io.marketStatus == "CLOSE") display = "block"
			else display = "none"

			if( io.stockEndType == "futures") name = io.futuresName;
			else name = io.indexName;
			var _html00 = `<div class="card" style="padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;min-height:10px;" id="market_index_${io.reutersCode}" data-cd-value="${io.reutersCode}" data-nm-value="${io.indexName}">`
			var _html01 =`
				<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
				<div class="">
					<span class="right floated" style="padding: 5px;background-color: #fff;min-height:35px;">
						<img src="https://ssl.pstatic.net/imgfinance/chart/mobile/world/mini/${io.reutersCode}_home_open.png?${Date.now()}" load="lazy" style="height:35px">
					</span>
					<span style="font-size:13px;"> ${name}</span> - <span style="font-size:11px;">  ${io.marketStatus}</span><br>
					<span style="font-size:14px;color:${status[ io.compareToPreviousPrice.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)}<br>
						<span style="font-size:12px;color:${status[ io.compareToPreviousPrice.name ].color}">${status[ io.compareToPreviousPrice.name ].symbol} ${io.compareToPreviousClosePrice}( ${ io.fluctuationsRatio}% )</span>
					</span>

				</div>
				


				<!--div class="description"></div-->
			`
			var _html02 =`</div>`
	
			var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
			var target_el = window.document.getElementById( "market_index_" + io.reutersCode )
			if( target_el )
			{
				//window._el.id_market_index.lastElementChild.parentNode.removeChild( target_el )
				//window._el.id_market_index.insertBefore( new_el,window._el.id_market_index.firstChild )
				target_el.innerHTML = _html01
				
			}
			else
			{
				window._el.id_market_index.appendChild( new_el )	
			}
		}
	}
}

window.wsFns.getExchangeIndex = function(){
		
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET" , `http://112.144.208.118:8888/getExchangeIndex`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			debugger;
			
			var d = JSON.parse( xhr.responseText )
			window.socketData.getExchangeIndex = d;
			//window._el.id_market_index.innerHTML = "";
			window.wsFns.renderExchangeIndex();
			
		}
	}
	
	xhr.send();

}
window.wsFns.renderExchangeIndex = function(){
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;

	var i = 0,iLen = window.socketData.getExchangeIndex.length,io;
	for(;i<iLen;++i){
		io = window.socketData.getExchangeIndex[ i ];
		//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)		
		var name = io.name;
		if( io.categoryType == "exchangeWorld") continue;

		if( io.marketStatus == "CLOSE") display = "block"
		else display = "none"
		
		var marketStatus = "";
		if( io.marketStatus != null ) marketStatus = ` - <span style="font-size:11px;">${io.marketStatus}</span>`;
		
		var _html00 = `<div class="card" style="margin-top:0px;padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;" id="exchange_index_${io.reutersCode}" data-cd-value="${io.reutersCode}" data-nm-value="${io.reutersCode}">`
		var _html01 =`
			<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
			<div class="">
				<span style="font-size:13px;"> ${name}</span>${marketStatus}
				<span class="right floated" style="font-size:12px;color:${status[ io.fluctuationsType.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)}   ${status[ io.fluctuationsType.name ].symbol} ${io.fluctuations}( ${ io.fluctuationsRatio}% )</span>
			</div>
			<!--div class="description"></div-->
		`
		var _html02 =`</div>`

		var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
		var target_el = window.document.getElementById( "exchange_index_" + io.reutersCode )
		if( target_el )
		{
			//window._el.id_exchange_index.lastElementChild.parentNode.removeChild( target_el )
			//window._el.id_exchange_index.insertBefore( new_el,window._el.id_exchange_index.firstChild )
			target_el.innerHTML = _html01
			
		}
		else
		{
			window._el.id_exchange_index.appendChild( new_el )	
		}
	}

}
window.wsFns.getEnergyIndex = function(){
		
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET" , `http://112.144.208.118:8888/getEnergyIndex`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			debugger;
			
			var d = JSON.parse( xhr.responseText )
			window.socketData.getEnergyIndex = d;
			//window._el.id_market_index.innerHTML = "";
			window.wsFns.renderEnergyIndex();
			
		}
	}
	
	xhr.send();

}
window.wsFns.renderEnergyIndex = function(){
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;

	var i = 0,iLen = window.socketData.getEnergyIndex.length,io;
	for(;i<iLen;++i){
		io = window.socketData.getEnergyIndex[ i ];
		//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)		
		var name = io.name;
		//if( io.categoryType == "exchangeWorld") continue;
		
		
		if( io.marketStatus == "CLOSE") display = "block"
		else display = "none"

		var marketStatus = "";
		if( io.marketStatus != null ) marketStatus = ` - <span style="font-size:11px;">${io.marketStatus}</span>`;
		
		var _html00 = `<div class="card" style="margin-top:0px;padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;" id="energy_index_${io.reutersCode}" data-cd-value="${io.reutersCode}" data-nm-value="${io.reutersCode}">`
		var _html01 =`
			<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
			<div class="">
				<span style="font-size:13px;"> ${name}</span>${marketStatus}
				<span class="right floated" style="font-size:12px;color:${status[ io.fluctuationsType.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)}   ${status[ io.fluctuationsType.name ].symbol} ${io.fluctuations}( ${ io.fluctuationsRatio}% )</span>
			</div>
			<!--div class="description"></div-->
		`
		var _html02 =`</div>`

		var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
		var target_el = window.document.getElementById( "energy_index_" + io.reutersCode )
		if( target_el )
		{
			//window._el.id_energy_index.lastElementChild.parentNode.removeChild( target_el )
			//window._el.id_energy_index.insertBefore( new_el,window._el.id_energy_index.firstChild )
			target_el.innerHTML = _html01
			
		}
		else
		{
			window._el.id_energy_index.appendChild( new_el )	
		}
	}

}

window.wsFns.getMetalIndex = function(){
		
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET" , `http://112.144.208.118:8888/getMetalIndex`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			debugger;
			
			var d = JSON.parse( xhr.responseText )
			window.socketData.getMetalIndex = d;
			//window._el.id_market_index.innerHTML = "";
			window.wsFns.renderMetalIndex();
			
		}
	}
	
	xhr.send();

}
window.wsFns.renderMetalIndex = function(){
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;

	var i = 0,iLen = window.socketData.getMetalIndex.length,io;
	for(;i<iLen;++i){
		io = window.socketData.getMetalIndex[ i ];
		//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)		
		var name = io.name;
		//if( io.categoryType == "exchangeWorld") continue;
		
		
		if( io.marketStatus == "CLOSE") display = "block"
		else display = "none"

		var marketStatus = "";
		if( io.marketStatus != null ) marketStatus = ` - <span style="font-size:11px;">${io.marketStatus}</span>`;
		
		var _html00 = `<div class="card" style="margin-top:0px;padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;" id="metal_index_${io.reutersCode}" data-cd-value="${io.reutersCode}" data-nm-value="${io.reutersCode}">`
		var _html01 =`
			<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
			<div class="">
				<span style="font-size:13px;"> ${name}</span>${marketStatus}
				<span class="right floated" style="font-size:12px;color:${status[ io.fluctuationsType.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)}   ${status[ io.fluctuationsType.name ].symbol} ${io.fluctuations}( ${ io.fluctuationsRatio}% )</span>
			</div>
			<!--div class="description"></div-->
		`
		var _html02 =`</div>`

		var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
		var target_el = window.document.getElementById( "metal_index_" + io.reutersCode )
		if( target_el )
		{
			//window._el.id_energy_index.lastElementChild.parentNode.removeChild( target_el )
			//window._el.id_energy_index.insertBefore( new_el,window._el.id_energy_index.firstChild )
			target_el.innerHTML = _html01
			
		}
		else
		{
			window._el.id_metal_index.appendChild( new_el )	
		}
	}

}

window.wsFns.getAgriculturalIndex = function(){
		
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET" , `http://112.144.208.118:8888/getAgriculturalIndex`, true);
	xhr.onreadystatechange = function(){
		
		if( xhr.readyState == 4 && xhr.status == 200)
		{
			debugger;
			
			var d = JSON.parse( xhr.responseText )
			window.socketData.getAgriculturalIndex = d;
			//window._el.id_market_index.innerHTML = "";
			window.wsFns.renderAgriculturalIndex();
			
		}
	}
	
	xhr.send();

}
window.wsFns.renderAgriculturalIndex = function(){
	var status = {
		"UNCHANGED" : {	color:"grey", symbol : "-",},
		"RISING" : {	color:"red", symbol : "▲",},
		"FALLING" : {	color:"blue", symbol : "▼",},
		//"UPPER_LIMIT" : {	color:"red", symbol : "▲",},
	}

	var display;

	var i = 0,iLen = window.socketData.getAgriculturalIndex.length,io;
	for(;i<iLen;++i){
		io = window.socketData.getAgriculturalIndex[ i ];
		//var color = window.UTIL.Color.generateColor('#FF0000','#cccccc',o.rt)		
		var name = io.name;
		//if( io.categoryType == "exchangeWorld") continue;
		
		
		if( io.marketStatus == "CLOSE") display = "block"
		else display = "none"

		var marketStatus = "";
		if( io.marketStatus != null ) marketStatus = ` - <span style="font-size:11px;">${io.marketStatus}</span>`;

		var _html00 = `<div class="card" style="margin-top:0px;padding: 5px!important;box-shadow: 0 1px 1px 0 #ccc, 0 0 0 1px #ccc !important;border-radius: 0rem !important;display:block;cursor:pointer;" id="agricultural_index_${io.reutersCode}" data-cd-value="${io.reutersCode}" data-nm-value="${io.reutersCode}">`
		var _html01 =`
			<div style="background-color: #97979747;position: absolute;width: 100%;height: 100%;z-index: 5;top: 0px;left: 0;display:${display};"></div>
			<div class="">
				<span style="font-size:13px;"> ${name}</span>${marketStatus}
				<span class="right floated" style="font-size:12px;color:${status[ io.fluctuationsType.name ].color}">${window.UTIL.Number.numberWithCommas(io.closePrice)}   ${status[ io.fluctuationsType.name ].symbol} ${io.fluctuations}( ${ io.fluctuationsRatio}% )</span>
			</div>
			<!--div class="description"></div-->
		`
		var _html02 =`</div>`

		var new_el = window.UTIL.Html.htmlToElement( _html00 + _html01 + _html02 )
		var target_el = window.document.getElementById( "agricultural_index_" + io.reutersCode )
		if( target_el )
		{
			//window._el.id_Agricultural_index.lastElementChild.parentNode.removeChild( target_el )
			//window._el.id_Agricultural_index.insertBefore( new_el,window._el.id_Agricultural_index.firstChild )
			target_el.innerHTML = _html01
			
		}
		else
		{
			window._el.id_agricultural_index.appendChild( new_el )	
		}
	}

}


window.addEventListener('DOMContentLoaded', (event) => {


	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;

	window._el = {}

	window._el.id_market_index = window.document.getElementById( "market_index" )
	window._el.id_market_index_1 = window.document.getElementById( "market_index_1" )
	window._el.id_exchange_index = window.document.getElementById( "exchange_index" )
	window._el.id_energy_index = window.document.getElementById( "energy_index" )
	window._el.id_metal_index = window.document.getElementById( "metal_index" )
	window._el.id_agricultural_index = window.document.getElementById( "agricultural_index" )


	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	window.barChart = {};
	window.barChart.curCd = null;


	window.socketData = {}

	window.date = {}
	window.date.curDate = window.UTIL.Date.getTimeTo__YYYYMMDD();
	window.date.curDateWidhDash = window.UTIL.Date.getTimeTo__YYYY_MM_DD();


	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;

	window.Websocket.init();

	window.COMPONENT.gnb();
	window.COMPONENT.stockSearch_global();
	window.COMPONENT.stockSearch_tradeValueBarchart();

	window.wsFns.getEnergyIndex();
	window.wsFns.getExchangeIndex();
	window.wsFns.getMetalIndex();
	window.wsFns.getAgriculturalIndex();
	window.wsFns.getMarketIndex( function(){ window.wsFns.getMarketIndexGlobal(); } );

	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;
	//-------------------------------------------------------;


	window.addEventListener('resize', function(e){ window.treemapChart.resize(); }, true);

	window.interval = {}
	//window.interval.renderUpdateRank_pp = setInterval(function(){
	//	if( !window.socketData.renderMassTransInfo_sell ) return;
	//	if( !window.socketData.renderMassTransInfo_buy ) return;
	//	window.wsFns.renderUpdateRank_pp()
	//},7000)
	//window.interval.renderUpdateRank_rt = setInterval(function(){
	//	if( !window.socketData.renderMassTransInfo_sell ) return;
	//	if( !window.socketData.renderMassTransInfo_buy ) return;
	//	window.wsFns.renderUpdateRank_rt()
	//},7000)
	//window.interval.renderMassTransList_buy = setInterval(function(){
	//	if( !window.socketData.renderMassTransInfo_sell ) return;
	//	if( !window.socketData.renderMassTransInfo_buy ) return;
	//	window.wsFns.renderMassTransList_buy()
	//},7000)
	window.interval.getTradeValueByCd = setInterval(function(){	window.COMPONENT.getTradeValueByCd(); },7000)
})
</script>

<body style="padding:50px;">
	<div class="ui grid">
		<div id="gnb" class="eight wide column" style="padding: 20px;"></div>
		<div id="search_wrap" class="eight wide column" style="padding: 20px;">
				
		</div>
		<div class="four wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="exchange_index_title" style="">
				환율지표
				</div>
				<div class="sixteen wide column">
					<div class="ui one cards" id="exchange_index"></div>
				</div>
			</div>
		</div>
		<div class="four wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="energy_index_title" style="">
				에너지 시장지표
				</div>
				<div class="sixteen wide column">
					<div class="ui one cards" id="energy_index"></div>
				</div>
			</div>
		</div>
		<div class="four wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="metal_index_title" style="">
				금속 시장지표
				</div>
				<div class="sixteen wide column">
					<div class="ui one cards" id="metal_index"></div>
				</div>
			</div>
		</div>
		<div class="four wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="agricultural_index_title" style="">
				농축산물 시장지표
				</div>
				<div class="sixteen wide column">
					<div class="ui one cards" id="agricultural_index"></div>
				</div>
			</div>
		</div>

		<div class="sixteen wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="market_index_title" style="">
				국내외증시
				</div>
				<div class="sixteen wide column">
					<div class="ui six cards" id="market_index"></div>
				</div>
			</div>
		</div>

		<div id="search_tradeValueBarchart_wrap" class="sixteen wide column" style="padding: 20px;"></div>

		<div class="sixteen wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="tradeValueByCd" style="height:300px;"></div>
			</div>
		</div>

		<div class="eight wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="tradeValueTreeGap" style="text-align:center;height:400px;padding:0px;"></div>		
			</div>
		</div>
		<div class="eight wide column">
			<div class="ui grid">
				<div class="sixteen wide column" id="tradeValueTree" style="text-align:center;height:400px;padding:0px;"></div>		
			</div>
		</div>
	</div>
</body>